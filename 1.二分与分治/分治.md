# 分治

- [分治](#分治)
  - [概括](#概括)
  - [应用](#应用)
    - [逆序对](#逆序对)
  - [例题](#例题)
    - [CF436D Pudding Monsters](#cf436d-pudding-monsters)
      - [题意简化](#题意简化)
      - [题解](#题解)

## 概括

如图

![概括](image-3.png)

## 应用

### 逆序对

考虑分治 $[l, mid]$ 与 $[mid+1, r]$ 中的逆序对，再考虑跨越 $mid$ 的逆序对。

## 例题

### CF436D Pudding Monsters

#### 题意简化

在 $n \times n$ 的棋盘上有几枚棋子，其中第 $i$ 枚棋子位于第 $i$ 行第 $y$ 列，保证每行每列恰有一枚棋子。现在你打算制作一个大小为 $k$ 的正方形外框( $k$ 由你在 $1 - n$ 的整数中指定)并框住 $k \times k$ 的子棋盘，使得其内共含枚棋子。求有多少种框法。

#### 题解

记 $a_i$ 表示第 $i$ 行棋子所在的列。

所以 $a_{1...n}$ 形成长度为 $n$ 的排列

考虑第 $i$ 行到第 $j$ 行的框法

$max\{a_i, ..., a_j\}-min\{a_i, ..., a_j\} = i-j$，否则无法框全。

于是问题从二维降至一维，即统计排列 $a$ 中有多少满足上式的 $[i, j]$ 子段。

考虑每次递归预处理以下数组：

- $sufmax[i] = max(a_i,a_{i+1}, ..., a_{mid})$
- $premax[j] = max(a_{mid+1}, ..., a_{j-1}, a_j)$
- $sufmin[i] = min(a_i,a_{i+1}, ..., a_{mid})$
- $premin[j] = min(a_{mid+1}, ..., a_{j-1}, a_j)$

原式即可被化简成：

$max\{sufmax[i], premax[j]\} - min\{sufmin[i], premin[j]\}=j - i$

接下来考虑 $max, min$ 的选取，共 $4$ 种。

- $max, min$ 取同侧

以都取左侧为例 $(sufmax, sufmin)$

在 $[l,mid]$ 中枚举 $i$，由等式， $j$ 是唯一确定的，所以只需要验证以下两条式子：

$\left\{
    \begin{aligned}
    &sufmax[i] \gt premax[j]\\
    &sufmin[i] \lt premin[j]
    \end{aligned}
\right.
$

- $max, min$ 异侧

以 $max$ 取左， $min$ 取右为例 $(sufmax, premin)$

$\left\{
    \begin{aligned}
    &i + surmax[i] = j + premin[j]\\
    &sufmax[i] \gt premax[j]\\
    &sufmin[i] \ge premin[j]
    \end{aligned}
\right.
$

从大到小枚举 $i$，发现 $j$ 是一个滑动的范围，可以用双指针维护。
